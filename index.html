<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Marcador de Quidditch</title>

  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">

  <!-- Iincludes -->
  <!-- mis ficheros -->
  <script src="js/equipos.js"></script>
  <script src="js/funciones.js"></script>
  <!-- ficheros genericos -->
  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/scripts.js"></script>

</head>
<body>

  <div class="container-fluid">
    <div class="row">
      <!-- COLUMNA EQUIPO 1 -->
      <div id="columna1" class="col-md-3">
        <img id="crest1" src="#" class=" crest">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Puesto</th>
              <th>Puntos</th>
              <th>Gol</th>
            </tr>
          </thead>
          <tbody id="equipo1">

          </tbody>
        </table>
      </div>

      <!-- COLUMNA MARCADOR -->
      <div class="col-md-6 text-center">
        <div class="row">
          <div class="col-4">
            <input class="seleccionEquipo btn btn-secondary" name="equipo1" type="button" value="<-- Equipo izquierda">
          </div>
          <div class="col-4">
            <form>
              <div class="form-group">
                <select class="form-control" id="equipos">
                  <option value="gryffindor">Gryffindor</option>
                  <option value="slytherin">Slytherin</option>
                  <option value="ravenclaw">Ravenclaw</option>
                  <option value="hufflepuff">Hufflepuff</option>
                </select>
              </div>
            </form>
          </div>
          <div class="col-4">
            <input class="seleccionEquipo btn btn-secondary" name="equipo2" type="button" value="Equipo derecha -->">
          </div>
        </div>

        <h3 class="text-center">
          MARCADOR
        </h3>
        <div class="row">
          <div class="col-md-6 text-center">
            <h1 id="marcador1">0</h1>
          </div>
          <div class="col-md-6 text-center">
            <h1 id="marcador2">0</h1>
          </div>
        </div>

        <div class="btn-group" role="group">
          <button class="btn btn-secondary" type="button">Gol</button>
        </div>
      </div>

      <!-- COLUMNA EQUIPO 2 -->
      <div class="col-md-3">
        <img id="crest2" src="#" class="crest">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Puesto</th>
              <th>Puntos</th>
              <th>Gol</th>
            </tr>
          </thead>
          <tbody id="equipo2">
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script type="text/javascript">
  $(document).ready(function() {

    //SELECCIONAR EQUIPOS
    //EQUIPO 1
    $('.seleccionEquipo').click(function() {
      //asignar a equipo el equipo seleccionado
      let equipo = $('#equipos option:selected').val();
      var color = "";
      if (equipo == 'gryffindor') {
        equipo = gryffindor;
        color = 'bg-danger';
      } else if (equipo == 'slytherin') {
        equipo = slytherin;
        color = 'bg-success';
      } else if (equipo == 'ravenclaw') {
        equipo = ravenclaw;
        color = 'bg-primary';
      } else if (equipo == 'hufflepuff') {
        equipo = hufflepuff;
        color = 'bg-warning';
      }

      if (this.name === 'equipo1') {
        $('#equipo1').empty();
        $('#columna1').addClass(color);

        //mostrar logo de equipo
        $('#crest1').attr('src', 'img/' + equipo.imagen);

        //mostrar los jugadores del equipo
        for (var i = 0; i <= 6; i++) {
          let player = equipo.jugadores.jugador[i];
          $('#equipo1').append(
            '<tr><td>' + player.nombre +
            '</td><td>' + player.posicion +
            '</td><td id="' + player.id + '">' + player.puntos +
            '</td><td><img name="' + player.id + '1" class="quaffle gol" src="img/quaffle.png"></td></tr>');
          }
        } else if (this.name === 'equipo2') {
          $('#equipo2').empty();

          //mostrar logo de equipo
          $('#crest2').attr('src', 'img/' + equipo.imagen);

          //mostrar los jugadores del equipo
          for (var i = 0; i <= 6; i++) {
            let player = equipo.jugadores.jugador[i];
            $('#equipo2').append(
              '<tr><td>' + player.nombre +
              '</td><td>' + player.posicion +
              '</td><td id="' + player.id + '">' + player.puntos +
              '</td><td><img name="' + player.id + '2" class="quaffle gol" src="img/quaffle.png"></td></tr>');
            }
        }

      });

      $(document).on("click", ".gol", function(){
        var jugador_id = this.name;
        var equipo;
        switch (jugador_id.charAt(0)) {
          case 'g':
          equipo = gryffindor;
          break;
          case 's':
          equipo = slytherin;
          break;
          case 'r':
          equipo = ravenclaw;
          break;
          case 'h':
          equipo = hufflepuff;
          break;
          default:
          alert('ID de jugador incorrecto');
        }

        let players = equipo.jugadores.jugador;
        let lado_marcador = jugador_id.charAt(2);
        jugador_id = jugador_id.substring(0, 2);
        for (var i = 0; i <= players.length - 1; i++) {
          if (players[i].id === jugador_id) {
            players[i].puntos += 10;
            equipo.puntos += 10;

            //actualizar la vista HTML
            $('#' + jugador_id).text(players[i].puntos);
            if (lado_marcador === '1') {
              $('#marcador1').text(equipo.puntos);
            } else if (lado_marcador === '2') {
              $('#marcador2').text(equipo.puntos);
            }
          }
        }
      });
    });
    </script>
  </body>
  </html>
